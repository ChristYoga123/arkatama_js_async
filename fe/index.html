<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>Atlantis Lite Bootstrap Dashboard</title>
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
	<link rel="icon" href="assets/img/icon.ico" type="image/x-icon"/>
	<link rel="stylesheet" href="assets/css/atlantis.min.css">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<script src="assets/js/plugin/webfont/webfont.min.js"></script>
	<script>
		WebFont.load({
			google: {"families":["Lato:300,400,700,900"]},
			custom: {"families":["Flaticon", "Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"], urls: ['assets/css/fonts.min.css']},
			active: function() {
				sessionStorage.fonts = true;
			}
		});
	</script>

	<link rel="stylesheet" href="assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/css/atlantis.min.css">
	<link href="assets/styles.css" rel="stylesheet" />
	<link href="assets/prism.css" rel="stylesheet" />
</head>
<body>
	<div class="wrapper">
		<div class="main-header">
			<div class="logo-header" data-background-color="light-blue2">
				<a href="index.html" class="logo">
					<img src="assets/img/logo.svg" alt="navbar brand" class="navbar-brand">
				</a>
				<button class="navbar-toggler sidenav-toggler ml-auto" type="button" data-toggle="collapse" data-target="collapse" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon">
						<i class="icon-menu"></i>
					</span>
				</button>
				<button class="topbar-toggler more"><i class="icon-options-vertical"></i></button>
				<div class="nav-toggle">
					<button class="btn btn-toggle toggle-sidebar">
						<i class="icon-menu"></i>
					</button>
				</div>
			</div>
			<nav class="navbar navbar-header navbar-expand-lg" data-background-color="light-blue2">
				<div class="container-fluid">
					<ul class="navbar-nav topbar-nav ml-md-auto align-items-center">
						<li class="nav-item">
							<a href="examples/demo1" class="nav-link">
								Live Preview
							</a>
						</li>
					</ul>
				</div>
			</nav>
		</div>
		<div class="sidebar sidebar-style-2">
			<div class="sidebar-background"></div>
			<div class="sidebar-wrapper scrollbar scrollbar-inner">
				<div class="sidebar-content">
					<ul class="nav nav-info">
						<li class="nav-item active">
							<a href="index.html">
								<i class="fas fa-home"></i>
								<p>Dashboard</p>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<div class="main-panel">
			<div class="content content-documentation">
				<div class="container-fluid">
					<div class="card card-documentation">
						<div class="card-header bg-info-gradient text-white bubble-shadow">
							<h4>Implementasi JS Async</h4>
						</div>
						<div class="card-body">
							<!-- Button trigger modal -->
							<button type="button" onclick="pilihKategori()" class="btn btn-primary" data-toggle="modal" data-target="#modalProduk">
								Tambah Produk
							</button>
							<div class="row ml-1 mt-3">
								<button type="button" onclick="pilihProduk()" class="btn btn-primary" data-toggle="modal" data-target="#modalPilihProduk">
									Pilih Produk
								</button>

								<input type="hidden" name="product_id">
								<input type="text" class="form-control ml-2 col-4" id="product_code" disabled placeholder="Kode Produk">
								<input type="text" class="form-control ml-2 col-4" id="product_name" disabled placeholder="Nama Produk">
								<input type="number" class="form-control ml-2 col-1" id="qty" placeholder="Qty">
							</div>
							<div class="row ml-1 mt-3">
								<button type="button" onclick="pilihBahan()" class="btn btn-primary" data-toggle="modal" data-target="#modalPilihBahan">
									Pilih Bahan
								</button>

								<input type="text" class="form-control ml-2 col-4" id="bahan_code" disabled placeholder="Kode Produk">
								<input type="text" class="form-control ml-2 col-4" id="bahan_name" disabled placeholder="Nama Produk">
								<button type="button" onclick="prosesIngredient()" class="btn btn-primary ml-2 col-1">Proses</button>
							</div>

							<hr>

							<h1>Bahan - Bahan</h1>

							<div class="output"></div>
							
							<div class="d-flex justify-content-end mt-3">
								<button class="btn btn-primary" onclick="cetakIngredient()">Cetak</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Modal Produk -->
	<div class="modal fade" id="modalProduk" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Tambah Produk</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="buat-produk">
						<div class="form-group">
							<label>Kode</label>
							<input type="text" class="form-control" placeholder="Kode Produk" name="product_code">
						</div>
						<div class="form-group">
							<label>Nama</label>
							<input type="text" class="form-control" placeholder="Nama Produk" name="product_name">
						</div>
						<div class="form-group">
							<label>Kategori</label>
							<select class="form-control" name="category_id">
								<option value="" disabled selected>Pilih Kategori</option>
								<!-- SELECT diisi API -->
							</select>
						</div>
						<div class="form-group">
							<label>Harga</label>
							<input type="number" min="1" class="form-control" placeholder="Harga Produk" name="price">
						</div>
						<div class="form-group">
							<label>Stok</label>
							<input type="number" min="1" class="form-control" placeholder="Stok Produk" name="quantity">
						</div>
						<div class="form-group">
							<label>Deskripsi</label>
							<textarea class="form-control" name="description"></textarea>
						</div>
						<button type="button" onclick="buatProduk()" id="button-tambah-edit" class="btn btn-primary mt-3 ml-2">Submit</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal Pilih Produk -->
	<div class="modal fade" id="modalPilihProduk" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Pilih Produk</h5>
					<button type="button" class="close" data-dismiss="modal" onclick="tutupModalProduk()" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="table-responsive">
						<table id="pilih-produk" class="display table table-striped table-hover" cellspacing="0" width="100%">
							<thead>
								<tr>
									<th>Kode</th>
									<th>Nama</th>
									<th>Harga</th>
									<th>Stok</th>
									<th>Aksi</th>
								</tr>
							</thead>
							<tbody>
								<!-- Content diisi API -->
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal Pilih Bahan -->
	<div class="modal fade" id="modalPilihBahan" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Pilih Bahan</h5>
					<button type="button" class="close" data-dismiss="modal" onclick="tutupModalBahan()" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="table-responsive">
						<table id="pilih-bahan" class="display table table-striped table-hover" cellspacing="0" width="100%">
							<thead>
								<tr>
									<th>Kode</th>
									<th>Nama</th>
									<th>Stok</th>
									<th>Aksi</th>
								</tr>
							</thead>
							<tbody>
								<!-- Content diisi API -->
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal Cetak Ingredient -->
	<div class="modal fade" id="modalCetakIngredient" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Cetak Bahan</h5>
					<button type="button" class="close" data-dismiss="modal" onclick="tutupModalBahan()" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					Kode: <h3 id="product_fix_code"></h3>
					Nama: <h3 id="product_fix_name"></h3>
					Qty: <h3 id="product_quantity"></h3>

					<hr>


					<div class="table-responsive">
						<table id="table-ingredients" class="display table table-striped table-hover" cellspacing="0" width="100%">
							<thead>
								<tr>
									<th>Kode</th>
									<th>Nama</th>
									<th>Stok</th>
								</tr>
							</thead>
							<tbody>
								<!-- Content diisi API -->
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>


</body>
<script src="assets/js/core/jquery.3.2.1.min.js"></script>
<!-- Sweet Alert -->
<script src="assets/js/plugin/sweetalert/sweetalert.min.js"></script>
<!-- Datatables -->
<script src="assets/js/plugin/datatables/datatables.min.js"></script>
<script src="assets/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
<script src="assets/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>
<script src="assets/js/core/popper.min.js"></script>
<script src="assets/js/core/bootstrap.min.js"></script>
<script src="assets/js/plugin/chart.js/chart.min.js"></script>
<script src="assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>
<script src="assets/js/plugin/bootstrap-toggle/bootstrap-toggle.min.js"></script>
<script type="text/javascript" src="assets/js/plugin/jqvmap/jquery.vmap.min.js"></script>
<script type="text/javascript" src="assets/js/plugin/jqvmap/maps/jquery.vmap.world.js" charset="utf-8"></script>
<script src="assets/js/plugin/chart-circle/circles.min.js"></script>
<script src="assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
<script src="assets/js/atlantis.min.js"></script>
<script src="documentation/assets/prism.js"></script>
<script src="documentation/assets/prism-normalize-whitespace.min.js"></script>
<script>
	// proses bahan
	let ingredients = [];
	let ingredients_fix = [];


	// jika modal di close maka datatable akan di destroy
	$('#modalPilihProduk').on('hidden.bs.modal', function () {
		$("table#pilih-produk").DataTable().destroy();
	});
	
	$("#modalPilihBahan").on('hidden.bs.modal', function () {
		$("table#pilih-bahan").DataTable().destroy();
	});

	function tutupModalProduk()
	{
		$("#modalProduk").modal("hide");
		// reinisialisasi datatable
		$("table#pilih-produk").DataTable().destroy();
	}

	function tutupModalBahan()
	{
		$("#modalPilihBahan").modal("hide");
		// reinisialisasi datatable
		$("table#pilih-bahan").DataTable().destroy();
	}
	
	function pilihKategori()
	{
		$("#modalProduk .modal-title").text("Tambah Produk");
		// nullkan isi form
		$("form#buat-produk")[0].reset();
		// empty select tapi beri option Pilih KAtegori disabled selected
		$('select[name=category_id]').empty().append(`<option value="" disabled selected>Pilih Kategori</option>`);		
		$.ajax({
			method: "GET",
			url: "http://localhost/js-async/be/api/categories",
			dataType: "json",
			success: function (response) {
				response.data.forEach(function (item) {
					$('select[name=category_id]').append(`<option value="${item.category_id}">${item.category_name}</option>`);
				});
			}
		});
	}

	function buatProduk()
	{
		$.ajax({
			method: "POST",
			url: "http://localhost/js-async/be/api/products",
			data: $("form#buat-produk").serialize(),
			success: function (response) {
				$("form#buat-produk")[0].reset();
				$("#modalProduk").modal("hide");
				swal(response.message, {
					icon: "success",
				});
			},
			statusCode: {
				400: function (xhr) {
					if(xhr.responseJSON.error.product_code)
					{
						swal(xhr.responseJSON.error.product_code, {
							icon: "error",
						});
					}
					if(xhr.responseJSON.error.product_name)
					{
						swal(xhr.responseJSON.error.product_name, {
							icon: "error",
						});
					}
					if(xhr.responseJSON.error.category_id)
					{
						swal(xhr.responseJSON.error.category_id, {
							icon: "error",
						});
					}
					if(xhr.responseJSON.error.price)
					{
						swal(xhr.responseJSON.error.price, {
							icon: "error",
						});
					}
					if(xhr.responseJSON.error.quantity)
					{
						swal(xhr.responseJSON.error.quantity, {
							icon: "error",
						});
					}
					if(xhr.responseJSON.error.description)
					{
						swal(xhr.responseJSON.error.description, {
							icon: "error",
						});
					}
				}
			}
		})
	}

	function pilihProduk()
	{
		$.ajax({
			method: "GET",
			url: "http://localhost/js-async/be/api/products",
			dataType: "json",
			success: function (response) {
				$("table#pilih-produk").DataTable({
					data: response.data,
					columns: [
						{data: "product_code"},
						{data: "product_name"},
						{data: "price"},
						{data: "quantity"},
					],
					order: [[ 0, "desc" ]],
					// buat kolom aksi dapat memuat 3 button yaitu Detail, Edit, Delete
					columnDefs: [
						{
							targets: 4,
							render: function (data, type, row, meta) {
								return `
									<div class="d-flex">
										<button type="button" onclick="selectProduk(${row.product_id})" class="btn btn-primary btn-sm">Pilih</button>
										<button type="button" onclick="editProduk(${row.product_id})" class="btn btn-warning btn-sm ml-2" data-dismiss="modal">Edit</button>
										<button type="button" onclick="deleteProduk(${row.product_id})" class="btn btn-danger btn-sm ml-2">Hapus</button>
									</div>
								`;
							}
						},
					]
				});
			}
		});
	}

	function selectProduk(id)
	{
		$("#modalPilihProduk").modal("hide");
		$.ajax({
			method: "GET",
			url: `http://localhost/js-async/be/api/products/${id}`,
			dataType: "json",
			success: function (response) {
				$("#product_code").val(response.data.product_code);
				$("#product_name").val(response.data.product_name);
				$("#qty").val(1);
				$("input[name=product_id]").val(response.data.product_id);
				// ambil data ingredient dari api
				$.ajax({
					url: "http://localhost/js-async/be/api/ingredients/" + id,
					method: "GET",
					dataType: "json",
					success: function(data)
					{
						data.data.map(ingredient => {
							ingredients.push(ingredient);
							$(".output").append(
								`
								<div class="row mt-3">
									<input type="text" class="form-control ml-2 col-4" id="ingredient_code" disabled placeholder="Kode Produk" value=${ingredient.ingredient_code}>
									<input type="text" class="form-control ml-2 col-3" id="ingredient_name" disabled placeholder="Nama Produk" value=${ingredient.ingredient_name}>
									<input type="number" class="form-control ml-2 col-3" id="ingredient_qty_${ingredient.ingredient_code}" placeholder="Stok Produk" value=${parseInt(ingredient.amount)}>
									<button type="button" onclick="hapusIngredient()" class="btn btn-danger ml-2 col-1">X</button>
								</div>
								`
							)
						})

						// cek jika stok diketik di atas stok bahan.json maka akan muncul swal
						$.ajax({
							url: "http://localhost/js-async/fe/assets/js/bahan.json",
							dataType: "json",
							success: function (response) {
								data.data.map(ingredient => {
									const bahan = response.filter(item => item.kode == ingredient.ingredient_code)
									$(`#ingredient_qty_${ingredient.ingredient_code}`).on("keyup", function () {
										if(parseInt($(`#ingredient_qty_${ingredient.ingredient_code}`).val()) > parseInt(bahan[0].stock))
										{
											swal("Stok bahan tidak mencukupi", {
												icon: "error",
											});
											$(`#ingredient_qty_${ingredient.ingredient_code}`).val(parseInt(bahan[0].stock));
										}
									})
								})
							}
						})
					},
					statusCode: {
						404: function (xhr) {
							swal(xhr.responseJSON.message, {
								icon: "info",
							});
							$(".output").empty();
							ingredients = [];
						}
					}
				})
			}
		});
	}

	function deleteProduk(id)
	{
		swal({
			title: "Apakah anda yakin?",
			text: "Setelah dihapus, Anda tidak akan dapat memulihkan data ini!",
			icon: "warning",
			buttons: true,
			dangerMode: true,
		})
		.then((willDelete) => {
			if(willDelete)
			{
				$.ajax({
					method: "DELETE",
					url: `http://localhost/js-async/be/api/products/${id}`,
					dataType: "json",
					success: function (response) {
						swal(response.message, {
							icon: "success",
						});
						// reinisialisasi datatable
						$("table#pilih-produk").DataTable().destroy();
						pilihProduk();
					}
				});
			}
		});
	}

	function editProduk(id)
	{
		$("#modalProduk").modal("show");
		// berikan scroll pada modal
		$("#modalProduk").css("overflow-y", "auto");
		$("#modalProduk .modal-title").text("Edit Produk");
		$('select[name=category_id]').empty().append(`<option value="" disabled selected>Pilih Kategori</option>`);		
		$.ajax({
			method: "GET",
			url: `http://localhost/js-async/be/api/products/${id}`,
			dataType: "json",
			success: function (response) {
				// isi data kategori
				$.ajax({
					method: "GET",
					url: "http://localhost/js-async/be/api/categories",
					dataType: "json",
					success: function (response) {
						response.data.forEach(function (item) {
							$('select[name=category_id]').append(`<option value="${item.category_id}">${item.category_name}</option>`);
						});
					}
				
				})
				$("input[name=product_code]").val(response.data.product_code);
				$("input[name=product_name]").val(response.data.product_name);
				$("select[name=category_id]").val(response.data.category_id);
				$("input[name=price]").val(response.data.price);
				$("input[name=quantity]").val(response.data.quantity);
				$("textarea[name=description]").val(response.data.description);
				$("button#button-tambah-edit").attr("onclick", `updateProduk(${response.data.product_id})`);
			}
		});
	}

	function updateProduk(id)
		{
			$.ajax({
				method: "PUT",
				url: `http://localhost/js-async/be/api/products/${id}`,
				data: $("form#buat-produk").serialize(),
				success: function (response) {
					$("form#buat-produk")[0].reset();
					$("#modalProduk").modal("hide");
					swal(response.message, {
						icon: "success",
					});
					// reinisialisasi datatable
					$("table#pilih-produk").DataTable().destroy();
				},
				statusCode: {
					400: function (xhr) {
						if(xhr.responseJSON.error.product_code)
						{
							swal(xhr.responseJSON.error.product_code, {
								icon: "error",
							});
						}
						if(xhr.responseJSON.error.product_name)
						{
							swal(xhr.responseJSON.error.product_name, {
								icon: "error",
							});
						}
						if(xhr.responseJSON.error.category_id)
						{
							swal(xhr.responseJSON.error.category_id, {
								icon: "error",
							});
						}
						if(xhr.responseJSON.error.price)
						{
							swal(xhr.responseJSON.error.price, {
								icon: "error",
							});
						}
						if(xhr.responseJSON.error.quantity)
						{
							swal(xhr.responseJSON.error.quantity, {
								icon: "error",
							});
						}
						if(xhr.responseJSON.error.description)
						{
							swal(xhr.responseJSON.error.description, {
								icon: "error",
							});
						}
					}
				}
			})
		
		}
	
	function pilihBahan()
	{
		$.ajax({
			method: "GET",
			url: "http://localhost/js-async/fe/assets/js/bahan.json",
			dataType: "json",
			success: function (response) {
				$("table#pilih-bahan").DataTable({
					data: response,
					columns: [
						{data: "kode"},
						{data: "nama"},
						{data: "stock"},
					],
					order: [[ 0, "desc" ]],
					// buat kolom aksi dapat memuat 3 button yaitu Detail, Edit, Delete
					columnDefs: [
						{
							targets: 3,
							render: function (data, type, row, meta) {
								return `
									<div class="d-flex">
										<button type="button" onclick="selectBahan(${row.id})" class="btn btn-primary btn-sm">Pilih</button>
									</div>
								`;
							}
						},
					]
				});
			}
		});
	}

	function selectBahan(id)
	{
		if($("#product_code").val() == "" || $("#product_name").val() == "" || $("#qty").val() == "" || $("#qty").val() == 0)
		{
			swal("Produk belum dipilih", {
				icon: "error",
			});
			return false;
		} else
		{
			$("#modalPilihBahan").modal("hide");
			$.ajax({
				url: "http://localhost/js-async/fe/assets/js/bahan.json",
				dataType: "json",
				success: function (response) {
					const bahan = response.filter(item => item.id == id)
					$("#bahan_code").val(bahan[0].kode);
					$("#bahan_name").val(bahan[0].nama);
				}
			})
		}
	}

	function prosesIngredient()
	{
		// cek jika produk atau bahan belum dipilih
		if($("#product_code").val() == "" || $("#product_name").val() == "" || $("#qty").val() == "" || $("#qty").val() == 0)
		{
			swal("Produk belum dipilih", {
				icon: "error",
			});
			return false;
		} else if($("#bahan_code").val() == "" || $("#bahan_name").val() == "")
		{
			swal("Bahan belum dipilih", {
				icon: "error",
			});
			return false;
		} else
		{
			// cek jika bahan sudah ada di array
			const bahan = ingredients.filter(item => item.ingredient_code == $("#bahan_code").val())
			if(bahan.length > 0)
			{
				swal("Bahan sudah dipilih", {
					icon: "error",
				});
				return false;
			} else
			{
				$(".output").append(
					`
					<div class="row mt-3">
						<input type="text" class="form-control ml-2 col-4" id="ingredient_code" disabled placeholder="Kode Produk" value=${$("#bahan_code").val()}>
						<input type="text" class="form-control ml-2 col-3" id="ingredient_name" disabled placeholder="Nama Produk" value=${$("#bahan_name").val()}>
						<input type="number" class="form-control ml-2 col-3" id="ingredient_qty_${$("#bahan_code").val()}" placeholder="Stok Produk" value="1">
						<button type="button" onclick="hapusIngredient()" class="btn btn-danger ml-2 col-1">X</button>
					</div>
					`
				)

				ingredients.push({
					"ingredient_code" : $("#bahan_code").val(),
					"ingredient_name": $("#bahan_name").val(),
					"amount": $("#qty").val(),
					"product_id": $("input[name=product_id]").val()
				});
				$("#bahan_code").val("");
				$("#bahan_name").val("");
			}
		}
	}

	function hapusIngredient()
	{
		// ambil kode bahan
		const kode = $(event.target).parent().find("#ingredient_code").val();
		// hapus bahan dari array
		ingredients = ingredients.filter(item => item.ingredient_code != kode);
		// hapus bahan dari DOM
		$(event.target).parent().remove();

		// jika stok diketik di atas stok di bahan.json maka akan muncul swal
		$.ajax({
			url: "http://localhost/js-async/fe/assets/js/bahan.json",
			dataType: "json",
			success: function (response) {
				const bahan = response.filter(item => item.kode == kode)
				$(`#ingredient_qty_${kode}`).on("keyup", function () {
					if(parseInt($(`#ingredient_qty_${kode}`).val()) > parseInt(bahan[0].stock))
					{
						swal("Stok bahan tidak mencukupi", {
							icon: "error",
						});
						$(`#ingredient_qty_${kode}`).val(parseInt(bahan[0].stock));
					}
				})
			}
		})
	}

	function cetakIngredient()
	{
		// cek jika ingredients di array kosong
		if(ingredients.length == 0)
		{
			swal("Bahan belum dipilih", {
				icon: "error",
			});
			return false;
		} else
		{
			// masukkan data ingredient_fix dari ingredient dengan pengecualian amount harus mengikuti inputan user
			ingredients.forEach(item => {
				ingredients_fix.push({
					"ingredient_code" : item.ingredient_code,
					"ingredient_name": item.ingredient_name,
					"amount": parseInt($(`#ingredient_qty_${item.ingredient_code}`).val()),
					"product_id": parseInt(item.product_id)
				})
			})
			console.log(ingredients_fix);
			// masukkan ke api
			$.ajax({
				method: "POST",
				url: "http://localhost/js-async/be/api/ingredients",
				dataType: "json",
				data: {
					"ingredients": ingredients_fix
				},
				success: function (response) {
					// tampilkan modal cetak
					$("#modalCetakIngredient").modal("show");
					// beri scroll pada modal
					$("#modalCetakIngredient").css("overflow-y", "auto");
					// isi data produk
					$("#product_fix_code").text($("#product_code").val());
					$("#product_fix_name").text($("#product_name").val());
					$("#product_quantity").text($("#qty").val());

					$("#product_code").val("");
					$("#product_name").val("");
					$("#qty").val("");
					// isi data ingredient
					$.ajax({
						url: "http://localhost/js-async/be/api/ingredients/" + $("input[name=product_id]").val(),
						method: "GET",
						dataType: "json",
						success: function(data)
						{
							data.data.map(ingredient => {
								$("#table-ingredients tbody").append(
									`
									<tr>
										<td>${ingredient.ingredient_code}</td>
										<td>${ingredient.ingredient_name}</td>
										<td>${ingredient.amount}</td>
									</tr>
									`
								)
							})
						},
					})
					$(".output").empty();
					ingredients = [];
					ingredients_fix = [];

					// jika modal cetak produk di close empty table
					$("#modalCetakIngredient").on('hidden.bs.modal', function () {
						$("#table-ingredients tbody").empty();
					});
				}
			
			})
		}
	}
</script>
<script type="text/javascript">
	// Optional
	Prism.plugins.NormalizeWhitespace.setDefaults({
		'remove-trailing': true,
		'remove-indent': true,
		'left-trim': true,
		'right-trim': true,
	});
	
	// handle links with @href started with '#' only
	$(document).on('click', 'a[href^="#"]', function(e) {
		// target element id
		var id = $(this).attr('href');

		// target element
		var $id = $(id);
		if ($id.length === 0) {
			return;
		}

		// prevent standard hash navigation (avoid blinking in IE)
		e.preventDefault();

		// top position relative to the document
		var pos = $id.offset().top - 80;

		// animated top scrolling
		$('body, html').animate({scrollTop: pos});
	});
</script>
</html>